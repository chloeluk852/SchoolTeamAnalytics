<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Preface School Team Analytics 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Montserrat", sans-serif;
        background-color: #f6f6f6;
        color: #404041;
      }
      .bg-primary-light {
        background-color: #85bcce;
      }
      .bg-pst {
        background-color: #45769d;
      }
      .bg-pcw {
        background-color: #bdcee2;
      }
      .text-pst {
        color: #45769d;
      }
      .border-pst {
        border-color: #45769d;
      }

      .card {
        background: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
      }
      .card:hover {
        transform: translateY(-2px);
      }
      .chart-container {
        position: relative;
        height: 240px;
        width: 100%;
      }
      .rank-circle {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-weight: 700;
        font-size: 0.7rem;
      }
      .rank-top {
        background-color: #45769d;
        color: white;
      }
      .rank-normal {
        background-color: #e6e7e8;
        color: #404041;
      }

      .table-container::-webkit-scrollbar {
        height: 6px;
      }
      .table-container::-webkit-scrollbar-thumb {
        background: #bdcee2;
        border-radius: 10px;
      }

      th {
        cursor: pointer;
        user-select: none;
        position: relative;
      }
      th:hover {
        color: #45769d;
      }
      .sort-icon::after {
        content: "‚Üï";
        margin-left: 4px;
        opacity: 0.3;
      }
      th.sort-asc .sort-icon::after {
        content: "‚Üë";
        opacity: 1;
      }
      th.sort-desc .sort-icon::after {
        content: "‚Üì";
        opacity: 1;
      }
    </style>
  </head>
  <body class="p-4 md:p-8">
    <!-- Header Section -->
    <header
      class="max-w-7xl mx-auto mb-8 flex flex-col md:flex-row justify-between items-end gap-4"
    >
      <div>
        <div class="flex items-center gap-3 mb-2">
          <div
            class="w-10 h-10 bg-pst rounded flex items-center justify-center overflow-hidden"
          >
            <img
              src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSC9IEGIxEUkALe_8c_tFqY0jbzySaCGdF_wQ&s"
              alt="Preface Logo"
              class="w-full h-full object-cover"
              onerror="this.src='https://placehold.co/40x40/45769d/ffffff?text=P'"
            />
          </div>
          <h1 class="text-3xl font-bold text-pst">
            School Team Analytics 2025
          </h1>
        </div>
        <p class="text-gray-500 font-medium">
          Annual Analysis: Sessions, Engagement & Performance
        </p>
      </div>
      <div class="flex gap-4">
        <div class="text-right">
          <p
            class="text-[10px] font-bold text-gray-400 uppercase tracking-widest"
          >
            Report Cycle
          </p>
          <p class="text-sm font-bold">FY2025 Annual</p>
        </div>
        <div
          class="bg-pst text-white px-4 py-2 rounded-lg font-semibold uppercase text-xs flex items-center tracking-wider"
        >
          Internal Only
        </div>
      </div>
    </header>

    <!-- Executive Summary Stats -->
    <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="card p-6 border-b-4 border-pst">
        <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">
          Total Sessions
        </p>
        <h2 class="text-4xl font-bold mt-2 text-pst">107</h2>
      </div>
      <div class="card p-6 border-b-4 border-pst">
        <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">
          Total Pax
        </p>
        <h2 class="text-4xl font-bold mt-2 text-pst">2,120</h2>
      </div>
      <div class="card p-6 border-b-4 border-pst">
        <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">
          Teaching Hours
        </p>
        <h2 class="text-4xl font-bold mt-2 text-pst">
          240<span class="text-lg">h</span>
        </h2>
      </div>
      <div class="card p-6 border-b-4 border-pst">
        <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">
          Weighted CSAT
        </p>
        <h2 class="text-4xl font-bold mt-2 text-pst">
          4.51<span class="text-base font-normal text-gray-400">/5</span>
        </h2>
      </div>
    </div>

    <!-- Main Analytics Grid -->
    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8 mb-8">
      <!-- Audience Distribution (Pie) -->
      <div class="card p-6 lg:col-span-4">
        <h3
          class="text-sm font-bold uppercase text-gray-500 mb-4 tracking-widest"
        >
          Audience Impact %
        </h3>
        <div class="chart-container">
          <canvas id="impactChart"></canvas>
        </div>
      </div>

      <!-- Language Impact Section -->
      <div
        class="card p-6 lg:col-span-4 bg-pst text-white relative overflow-hidden"
      >
        <div class="relative z-10">
          <h3
            class="text-sm font-bold uppercase text-blue-100 mb-4 tracking-widest"
          >
            Language Distribution
          </h3>
          <div class="flex justify-between items-end mb-6">
            <div>
              <p class="text-3xl font-bold text-[#85bcce]">63.6%</p>
              <p class="text-[10px] uppercase font-bold text-[#85bcce]">
                Cantonese (68 Sessions)
              </p>
            </div>
            <div class="text-right">
              <p class="text-3xl font-bold text-[#bdcee2]">36.4%</p>
              <p class="text-[10px] uppercase font-bold text-[#bdcee2]">
                English (39 Sessions)
              </p>
            </div>
          </div>
          <div class="chart-container !h-32">
            <canvas id="languageChart"></canvas>
          </div>
        </div>
        <div
          class="absolute -bottom-10 -right-10 w-32 h-32 bg-white/10 rounded-full"
        ></div>
      </div>

      <!-- CSAT by Segment (Bar) -->
      <div class="card p-6 lg:col-span-4">
        <h3
          class="text-sm font-bold uppercase text-gray-500 mb-4 tracking-widest"
        >
          CSAT by Segment
        </h3>
        <div class="chart-container">
          <canvas id="csatChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Interactive Instructor Ranking Matrix -->
    <div class="max-w-7xl mx-auto mb-8">
      <div class="card overflow-hidden">
        <div
          class="p-6 border-b border-gray-100 flex justify-between items-center bg-white"
        >
          <div>
            <h3 class="text-xl font-bold">Instructor Performance Ranking</h3>
            <p class="text-xs text-gray-400 mt-1">
              Click headers to sort instructors (A-Z, Z-A, or Value)
            </p>
          </div>
        </div>
        <div class="table-container overflow-x-auto">
          <table class="w-full text-left" id="instructorTable">
            <thead class="bg-gray-50">
              <tr>
                <th class="p-4 text-xs font-bold text-gray-500 uppercase w-16">
                  Rank
                </th>
                <th
                  class="p-4 text-xs font-bold text-gray-500 uppercase"
                  onclick="sortData('name')"
                >
                  Instructor <span class="sort-icon"></span>
                </th>
                <th
                  class="p-4 text-xs font-bold text-gray-500 uppercase text-center"
                  onclick="sortData('sessions')"
                >
                  Sessions <span class="sort-icon"></span>
                </th>
                <th
                  class="p-4 text-xs font-bold text-gray-500 uppercase text-center"
                  onclick="sortData('pax')"
                >
                  Pax Volume <span class="sort-icon"></span>
                </th>
                <th
                  class="p-4 text-xs font-bold text-gray-500 uppercase"
                  onclick="sortData('target')"
                >
                  Top Audience <span class="sort-icon"></span>
                </th>
                <th
                  class="p-4 text-xs font-bold text-gray-500 uppercase text-right"
                  onclick="sortData('score')"
                >
                  Instructor Score <span class="sort-icon"></span>
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100" id="tableBody">
              <!-- Data injected by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Qualitative Insights & Strategic Path -->
    <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
      <div class="card p-6">
        <h3 class="text-xl font-bold mb-4 border-l-4 border-pst pl-3">
          Qualitative Highlights
        </h3>
        <div class="space-y-4">
          <div class="p-4 bg-gray-50 rounded-lg">
            <div class="flex items-center gap-2 mb-1">
              <span class="text-pst text-lg">üíª</span>
              <p class="text-xs font-bold text-pst uppercase tracking-tighter">
                Hands-On Demand
              </p>
            </div>
            <p class="text-sm italic text-gray-600">
              "Maybe we could do more on the computer as at the starting lessons
              we just listened." --Delia Memorial School (Broadway) - AI
              Literacy
            </p>
          </div>
          <div class="p-4 bg-gray-50 rounded-lg">
            <div class="flex items-center gap-2 mb-1">
              <span class="text-pst text-lg">üë©‚Äçüè´</span>
              <p class="text-xs font-bold text-pst uppercase tracking-tighter">
                Workflow Utility
              </p>
            </div>
            <p class="text-sm italic text-gray-600">
              "Scanning student papers and getting tips to mark work was the
              most useful part for staff." --HKUGA x St. Stephen's College -
              Teacher Training
            </p>
          </div>
        </div>
      </div>

      <div class="card p-6">
        <h3 class="text-xl font-bold mb-4 border-l-4 border-pst pl-3">
          2026 Strategy
        </h3>
        <div class="space-y-4">
          <div class="flex gap-4">
            <div
              class="flex-shrink-0 w-8 h-8 bg-pst text-white rounded flex items-center justify-center font-bold"
            >
              1
            </div>
            <p class="text-sm leading-snug">
              <span class="font-bold text-pst">70/30 Rule:</span> Transition to
              70% active practice to address "listening only" fatigue.
            </p>
          </div>
          <div class="flex gap-4">
            <div
              class="flex-shrink-0 w-8 h-8 bg-pst text-white rounded flex items-center justify-center font-bold"
            >
              2
            </div>
            <p class="text-sm leading-snug">
              <span class="font-bold text-pst">Growth Focus:</span> Prioritize
              University (4.82) and Primary (4.90) for high-impact scaling.
            </p>
          </div>
          <div class="flex gap-4">
            <div
              class="flex-shrink-0 w-8 h-8 bg-pst text-white rounded flex items-center justify-center font-bold"
            >
              3
            </div>
            <p class="text-sm leading-snug">
              <span class="font-bold text-pst">Governance:</span> Solve the
              feedback gap for SEN sessions and NIL instructors.
            </p>
          </div>
        </div>
      </div>
    </div>

    <script>
      const palette = [
        "#45769d",
        "#85bcce",
        "#bdcee2",
        "#387dff",
        "#7cb9e8",
        "#e4bf63",
        "#e6e7e8",
        "#404041",
      ];

      // Initial Data from Sheet1 (1).csv
      let instructors = [
        {
          name: "Cman",
          sessions: 17,
          pax: 30,
          score: 4.83,
          target: "Secondary Student",
        },
        {
          name: "Jason",
          sessions: 6,
          pax: 43,
          score: 4.75,
          target: "Primary Student",
        },
        { name: "Sean", sessions: 3, pax: 186, score: 4.54, target: "Teacher" },
        {
          name: "Harsh",
          sessions: 17,
          pax: 579,
          score: 4.53,
          target: "Secondary Student",
        },
        {
          name: "Joey",
          sessions: 18,
          pax: 665,
          score: 4.47,
          target: "Teacher",
        },
        { name: "Rene", sessions: 1, pax: 30, score: 4.45, target: "Teacher" },
        {
          name: "Scott",
          sessions: 26,
          pax: 230,
          score: 4.4,
          target: "Secondary Student",
        },
        {
          name: "Tommie",
          sessions: 1,
          pax: 91,
          score: 4.38,
          target: "Secondary Student",
        },
        {
          name: "Rocky, JJ",
          sessions: 1,
          pax: 50,
          score: 4.32,
          target: "Secondary Student",
        },
        {
          name: "Timmy",
          sessions: 6,
          pax: 25,
          score: 4.25,
          target: "Secondary Student",
        },
        {
          name: "Alfred",
          sessions: 4,
          pax: 217,
          score: 4.19,
          target: "Teacher",
        },
        {
          name: "Stacey",
          sessions: 16,
          pax: 85,
          score: 4.07,
          target: "Secondary Student",
        },
      ];

      let currentSort = { prop: "score", dir: "desc" };

      function renderTable() {
        const tbody = document.getElementById("tableBody");
        tbody.innerHTML = "";

        // Sort by score first to determine ranks
        const rankedList = [...instructors].sort((a, b) => b.score - a.score);

        instructors.forEach((item, index) => {
          const rank = rankedList.findIndex((r) => r.name === item.name) + 1;
          const isNil = item.score === 0;

          const row = document.createElement("tr");
          if (isNil) row.className = "bg-gray-50/50";

          row.innerHTML = `
                    <td class="p-4">
                        <div class="rank-circle ${
                          rank <= 3 && !isNil ? "rank-top" : "rank-normal"
                        }">
                            ${isNil ? "-" : rank}
                        </div>
                    </td>
                    <td class="p-4 font-semibold ${
                      isNil ? "text-gray-400" : ""
                    }">${item.name}</td>
                    <td class="p-4 text-center ${
                      isNil ? "text-gray-400" : "text-gray-500"
                    }">${item.sessions}</td>
                    <td class="p-4 text-center ${
                      isNil ? "text-gray-400 font-normal" : "font-medium"
                    }">${item.pax}</td>
                    <td class="p-4 text-xs ${
                      isNil ? "text-gray-300 italic" : "text-gray-600"
                    }">${item.target}</td>
                    <td class="p-4 font-bold text-right ${
                      isNil ? "text-gray-300 italic" : "text-pst"
                    }">
                        ${isNil ? "NIL" : item.score.toFixed(2)}
                    </td>
                `;
          tbody.appendChild(row);
        });
      }

      window.sortData = function (prop) {
        const headers = document.querySelectorAll("th");
        headers.forEach((h) => h.classList.remove("sort-asc", "sort-desc"));

        if (currentSort.prop === prop) {
          currentSort.dir = currentSort.dir === "asc" ? "desc" : "asc";
        } else {
          currentSort.prop = prop;
          currentSort.dir = "desc";
        }

        const activeHeader = Array.from(headers).find((h) =>
          h.getAttribute("onclick")?.includes(`'${prop}'`)
        );
        activeHeader?.classList.add(
          currentSort.dir === "asc" ? "sort-asc" : "sort-desc"
        );

        instructors.sort((a, b) => {
          let valA = a[prop];
          let valB = b[prop];

          if (typeof valA === "string") {
            return currentSort.dir === "asc"
              ? valA.localeCompare(valB)
              : valB.localeCompare(valA);
          } else {
            return currentSort.dir === "asc" ? valA - valB : valB - valA;
          }
        });

        renderTable();
      };

      // Initial render
      window.onload = function () {
        renderTable();

        // Charts
        const ctxImpact = document
          .getElementById("impactChart")
          .getContext("2d");
        new Chart(ctxImpact, {
          type: "doughnut",
          data: {
            labels: [
              "Sec. Student",
              "Teacher",
              "Staff",
              "Parent+Sec",
              "Univ.",
              "Primary",
              "SEN",
              "Parent",
            ],
            datasets: [
              {
                data: [38.02, 34.39, 11.89, 6.13, 4.06, 3.21, 2.31, 1.42],
                backgroundColor: palette,
                borderWidth: 2,
                borderColor: "#ffffff",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  font: { family: "Montserrat", size: 9 },
                  padding: 12,
                  boxWidth: 10,
                },
              },
            },
            cutout: "70%",
          },
        });

        const ctxLang = document
          .getElementById("languageChart")
          .getContext("2d");
        new Chart(ctxLang, {
          type: "bar",
          data: {
            labels: ["Language Split"],
            datasets: [
              {
                label: "Cantonese",
                data: [63.55],
                backgroundColor: "#85bcce",
                borderRadius: 4,
              },
              {
                label: "English",
                data: [36.45],
                backgroundColor: "#bdcee2",
                borderRadius: 4,
              },
            ],
          },
          options: {
            indexAxis: "y",
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: { stacked: true, display: false, max: 100 },
              y: { stacked: true, display: false },
            },
            plugins: { legend: { display: false } },
          },
        });

        const ctxCsat = document.getElementById("csatChart").getContext("2d");
        new Chart(ctxCsat, {
          type: "bar",
          data: {
            labels: [
              "Primary",
              "Univ.",
              "Staff",
              "Parent",
              "Sec.",
              "P-C Par.",
              "P-C Stu.",
              "Teacher",
            ],
            datasets: [
              {
                label: "Avg. CSAT",
                data: [4.9, 4.82, 4.57, 4.53, 4.39, 4.39, 4.28, 4.23],
                backgroundColor: "#85bcce",
                borderRadius: 4,
                barThickness: 18,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                min: 4.0,
                max: 5.0,
                ticks: { font: { size: 10 }, stepSize: 0.2 },
              },
              x: {
                grid: { display: false },
                ticks: { font: { family: "Montserrat", size: 8 } },
              },
            },
            plugins: { legend: { display: false } },
          },
        });
      };
    </script>
  </body>
</html>
